<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventBus (Mitt) 通信示例</title>
    <!-- 引入Vue -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入Mitt -->
    <script src="https://unpkg.com/mitt@3.0.0/dist/mitt.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        .description {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #42b983;
            border-radius: 4px;
        }
        .components-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .component {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .parent-component {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
            min-height: 250px;
        }
        .child-component {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            min-height: 250px;
        }
        .sibling-a {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
        }
        .sibling-b {
            background-color: #fce4ec;
            border: 2px solid #e91e63;
        }
        h2, h3 {
            margin-bottom: 15px;
            text-align: center;
        }
        .component-content {
            padding: 10px;
        }
        .message-box {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 4px;
        }
        .message-box.received {
            background-color: rgba(0, 0, 0, 0.05);
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 8px 12px;
            background-color: #42b983;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3aa876;
        }
        .log-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .log-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .log-entry {
            margin-bottom: 5px;
            font-family: monospace;
            padding: 5px;
            background-color: #f1f1f1;
            border-radius: 3px;
        }
        .event-flow {
            margin: 30px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .event-flow h3 {
            text-align: left;
            margin-bottom: 10px;
        }
        .event-flow ul {
            padding-left: 20px;
        }
        .event-flow li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
<!-- 229970544 卓玉晟 -->
    <div id="app">
        <div class="container">
            <h1>EventBus (Mitt) 通信示例</h1>
                <div class="event-flow">
                    <h3>事件通信流程</h3>
                    <ul>
                        <li><strong>父子组件通信</strong>：父组件通过 emit('parent-to-child') 发送消息，子组件通过 on('parent-to-child') 接收；反之亦然。</li>
                        <li><strong>兄弟组件通信</strong>：兄弟组件A通过 emit('sibling-a-to-b') 发送消息，兄弟组件B通过 on('sibling-a-to-b') 接收；反之亦然。</li>
                        <li><strong>事件总线原理</strong>：所有组件共享同一个 eventBus 实例，通过事件名称进行消息的发布与订阅。</li>
                    </ul>
                </div>
            
            <!-- 父子组件通信示例 -->
            <h2>父组件与子组件通信</h2>
            <div class="components-container">
                <parent-component></parent-component>
                <child-component></child-component>
            </div>
            
            <!-- 兄弟组件通信示例 -->
            <h2>兄弟组件通信</h2>
            <div class="components-container">
                <sibling-a-component></sibling-a-component>
                <sibling-b-component></sibling-b-component>
            </div>
            
            <!-- 事件日志 -->
            <div class="log-container">
                <div class="log-title">事件日志:</div>
                <div v-for="(log, index) in eventLogs" :key="index" class="log-entry">
                    {{ log }}
                </div>
            </div>
        </div>
    </div>

    <script>
        // 创建事件总线
        const eventBus = mitt()
        
        // 父组件
        const ParentComponent = {
            template: `
                <div class="component parent-component">
                    <h3>父组件</h3>
                    <div class="component-content">
                        <div class="message-box">
                            <label>发送给子组件的消息:</label>
                            <input v-model="parentMessage" placeholder="输入消息内容..." />
                            <button @click="sendToChild">发送给子组件</button>
                        </div>
                        <div class="message-box received">
                            <label>收到子组件的消息:</label>
                            <div>{{ receivedFromChild }}</div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const { ref, onBeforeMount, inject } = Vue
                
                const parentMessage = ref('父组件的消息')
                const receivedFromChild = ref('等待子组件消息...')
                const logEvent = inject('logEvent')
                
                // 向子组件发送消息
                const sendToChild = () => {
                    const data = {
                        message: parentMessage.value,
                        timestamp: new Date().toLocaleTimeString()
                    }
                    eventBus.emit('parent-to-child', data)
                    logEvent(`父组件发送消息: ${JSON.stringify(data)}`)
                }
                
                // 监听子组件发送的消息
                onBeforeMount(() => {
                    eventBus.on('child-to-parent', (data) => {
                        receivedFromChild.value = `${data.message} (${data.timestamp})`
                        logEvent(`父组件接收消息: ${JSON.stringify(data)}`)
                    })
                })
                
                return {
                    parentMessage,
                    sendToChild,
                    receivedFromChild
                }
            }
        }
        
        // 子组件
        const ChildComponent = {
            template: `
                <div class="component child-component">
                    <h3>子组件</h3>
                    <div class="component-content">
                        <div class="message-box">
                            <label>发送给父组件的消息:</label>
                            <input v-model="childMessage" placeholder="输入消息内容..." />
                            <button @click="sendToParent">发送给父组件</button>
                        </div>
                        <div class="message-box received">
                            <label>收到父组件的消息:</label>
                            <div>{{ receivedFromParent }}</div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const { ref, onBeforeMount, inject } = Vue
                
                const childMessage = ref('子组件的消息')
                const receivedFromParent = ref('等待父组件消息...')
                const logEvent = inject('logEvent')
                
                // 向父组件发送消息
                const sendToParent = () => {
                    const data = {
                        message: childMessage.value,
                        timestamp: new Date().toLocaleTimeString()
                    }
                    eventBus.emit('child-to-parent', data)
                    logEvent(`子组件发送消息: ${JSON.stringify(data)}`)
                }
                
                // 监听父组件发送的消息 - 改用onBeforeMount确保更早地注册事件监听
                onBeforeMount(() => {
                    eventBus.on('parent-to-child', (data) => {
                        receivedFromParent.value = `${data.message} (${data.timestamp})`
                        logEvent(`子组件接收消息: ${JSON.stringify(data)}`)
                    })
                })
                
                return {
                    childMessage,
                    sendToParent,
                    receivedFromParent
                }
            }
        }
        
        // 兄弟组件A
        const SiblingAComponent = {
            template: `
                <div class="component sibling-a">
                    <h3>兄弟组件A</h3>
                    <div class="component-content">
                        <div class="message-box">
                            <label>发送给兄弟组件B的消息:</label>
                            <input v-model="messageToB" placeholder="输入消息内容..." />
                            <button @click="sendToB">发送给组件B</button>
                        </div>
                        <div class="message-box received">
                            <label>收到兄弟组件B的消息:</label>
                            <div>{{ receivedFromB }}</div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const { ref, onBeforeMount, inject } = Vue
                
                const messageToB = ref('来自组件A的消息')
                const receivedFromB = ref('等待组件B消息...')
                const logEvent = inject('logEvent')
                
                // 向兄弟组件B发送消息
                const sendToB = () => {
                    const data = {
                        message: messageToB.value,
                        timestamp: new Date().toLocaleTimeString()
                    }
                    eventBus.emit('sibling-a-to-b', data)
                    logEvent(`兄弟组件A发送消息: ${JSON.stringify(data)}`)
                }
                
                // 监听兄弟组件B发送的消息
                onBeforeMount(() => {
                    eventBus.on('sibling-b-to-a', (data) => {
                        receivedFromB.value = `${data.message} (${data.timestamp})`
                        logEvent(`兄弟组件A接收消息: ${JSON.stringify(data)}`)
                    })
                })
                
                return {
                    messageToB,
                    sendToB,
                    receivedFromB
                }
            }
        }
        
        // 兄弟组件B
        const SiblingBComponent = {
            template: `
                <div class="component sibling-b">
                    <h3>兄弟组件B</h3>
                    <div class="component-content">
                        <div class="message-box">
                            <label>发送给兄弟组件A的消息:</label>
                            <input v-model="messageToA" placeholder="输入消息内容..." />
                            <button @click="sendToA">发送给组件A</button>
                        </div>
                        <div class="message-box received">
                            <label>收到兄弟组件A的消息:</label>
                            <div>{{ receivedFromA }}</div>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const { ref, onBeforeMount, inject } = Vue
                
                const messageToA = ref('来自组件B的消息')
                const receivedFromA = ref('等待组件A消息...')
                const logEvent = inject('logEvent')
                
                // 向兄弟组件A发送消息
                const sendToA = () => {
                    const data = {
                        message: messageToA.value,
                        timestamp: new Date().toLocaleTimeString()
                    }
                    eventBus.emit('sibling-b-to-a', data)
                    logEvent(`兄弟组件B发送消息: ${JSON.stringify(data)}`)
                }
                
                // 监听兄弟组件A发送的消息
                onBeforeMount(() => {
                    eventBus.on('sibling-a-to-b', (data) => {
                        receivedFromA.value = `${data.message} (${data.timestamp})`
                        logEvent(`兄弟组件B接收消息: ${JSON.stringify(data)}`)
                    })
                })
                
                return {
                    messageToA,
                    sendToA,
                    receivedFromA
                }
            }
        }
        
        // 创建Vue应用
        const app = Vue.createApp({
            setup() {
                const { ref, provide } = Vue
                
                // 存储事件日志
                const eventLogs = ref([])
                
                // 记录事件日志的方法
                const logEvent = (message) => {
                    const timestamp = new Date().toLocaleTimeString()
                    eventLogs.value.push(`[${timestamp}] ${message}`)
                    // 保持日志不超过20条
                    if (eventLogs.value.length > 20) {
                        eventLogs.value.shift()
                    }
                }
                
                // 提供日志方法给所有组件
                provide('logEvent', logEvent)
                
                return {
                    eventLogs
                }
            },
            components: {
                ParentComponent,
                ChildComponent,
                SiblingAComponent,
                SiblingBComponent
            }
        })
        
        // 挂载应用
        app.mount('#app')
    </script>
</body>
</html> 